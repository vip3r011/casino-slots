var db=new PouchDB("users");const mainActive="main_active",slotsActive="slots_active",drumRing=".slots-main__drum-ring",drumSlot=".slots-main__drum-slot",tableRow=".slots-top__table-row",tableRowWin="slots-top__table-row_blink",coinLine=".slots-main__coin-line",coinLineOn="slots-main__coin-line_active",coinLineWin="slots-main__coin-line_blink",app=new Vue({el:"#app",data:{gamblingSectionShow:!1,modalSubNameCurrent:null,userFound:!1,questionCorrect:!1,modalMessages:"",modalOther:!1,topUsers:[],combSeven:!1,userName:"",userNameHidden:"",userPass:"",userHint:"",userHintHidden:"",userBank:"",userRate:0,userWin:0,userLoss:0,userRatio:0,userSpins:0,userRate1:0,userRate2:0,userRate3:0,userWinsCoin1:0,userWinsCoin2:0,userWinsCoin3:0,coinsPlayed:0,credits:0,creditsHidden:0,winnerPaid:0,btnCashOut:!1,btnPlayMax:!1,btnSpin:!1,btnBetOne:!1,drumsRing:document.querySelectorAll(drumRing),drumsSlots:document.querySelectorAll(drumSlot),degrees:[0,45,90,135,180,225,270,315,360],spinTime:4e3,spinAvialable:!1,spinRepeat:!1,spinPred:!0,tableRows:document.querySelectorAll(tableRow),coinLinesTemp:{},coinLines:{},combs:{comb7:[{slot1:"seven",slot2:"seven",slot3:"seven"},1e4],comb6:[{slot1:"watermelon",slot2:"watermelon",slot3:"watermelon"},100],comb5:[{slot1:"bell",slot2:"bell",slot3:"bell"},50],comb4:[{slot1:"lemon",slot2:"lemon",slot3:"lemon"},20],comb3:[{slot1:"orange",slot2:"orange",slot3:"orange"},10],comb2:[{slot1:"cherry",slot2:"cherry"},7],comb1:[{slot1:"cherry"},5]}},methods:{openModal(modalName,modalSubName){let modalThis=eval(`this.$refs.${modalName}`);"modalEnter"===modalName?(app.modalSubNameCurrent=modalSubName,$.fancybox.open(modalThis,{modal:!0,animationDuration:"400",animationEffect:"slide-in-out",beforeShow:()=>{"signin"===app.modalSubNameCurrent?app.modalMessages="Введите Ваше имя...":"signup"===app.modalSubNameCurrent&&(app.modalMessages="Сначала укажите Ваше имя...")},afterClose:()=>{app.clearModal()}})):"modalAccount"===modalName?$.fancybox.open(modalThis,{modal:!0,animationDuration:"400",animationEffect:"slide-in-out",beforeShow:()=>{app.modalMessages="Укажите сумму которую хотите добавить в игровой автомат..."},afterClose:()=>{app.userRate=0}}):"modalProfile"===modalName?$.fancybox.open(modalThis,{modal:!0,animationDuration:"400",animationEffect:"slide-in-out"}):"modalRules"===modalName&&$.fancybox.open(modalThis,{modal:!0,animationDuration:"400",animationEffect:"slide-in-out"})},clearModal(){app.userName="",app.userPass="",app.userHint="",app.userFound=!1},spotUser(){db.allDocs({include_docs:!0,attachments:!0}).then(e=>{app.searchDB(e.rows)})},searchDB(e){let a=_.find(e,e=>e.doc.userName===app.userName);"signin"===app.modalSubNameCurrent?app.oldUser(a):"signup"===app.modalSubNameCurrent&&app.newUser(a)},newUser(e){if(e){let e=["Это имя уже занято другим игроком...","К сожалению, с таким именем уже существует игрок!","А вот с таким именем уже есть игрок! Добавьте уникальности..."];app.modalMessages=e[getRandom(0,e.length)],app.userFound=!1}else if(e||""!==app.userName)e||""===app.userName||(app.modalMessages="Отлично! Задайте пароль и придумайте подсказку к нему. Без пароля, в будущем, не возможно будет войти в игру под указаным Вами именем...",app.userFound=!0);else{let e=["Нужно указать имя...","Без имени не получиться начать игру!","Поле с именем не должно быть пустым!"];app.modalMessages=e[getRandom(0,e.length)],app.userFound=!1}},oldUser(e){if(""===app.userName){let e=["Пожалуйста, введите имя...","Впишите имя, которое Вы указывали при регистрации!","Для того чтобы продолжить, нужно ввести имя!"];app.modalMessages=e[getRandom(0,e.length)]}else e?(app.modalMessages="Укажите Ваш пароль...",app.userFound=!0,db.get(app.userName).then(e=>{app.userHint=e.userHint,app.userPassHidden=e.userPass,app.userNameHidden=e.userName,app.userBank=e.userBank,app.userSpins=e.userSpins,app.userRate1=e.userRate1,app.userRate2=e.userRate2,app.userRate3=e.userRate3,app.userWinsCoin1=e.userWinsCoin1,app.userWinsCoin2=e.userWinsCoin2,app.userWinsCoin3=e.userWinsCoin3})):(app.modalMessages="Нет игрока с таким именем! Проверьте корректность имени или станьте новым игроком с таким именем...",app.userFound=!1)},addUser(e,a,s){db.put({_id:e,userName:e,userBank:500,userSpins:0,userRate1:0,userRate2:0,userRate3:0,userWinsCoin1:0,userWinsCoin2:0,userWinsCoin3:0,userPass:a,userHint:s}),db.get(app.userName).then(e=>{app.userNameHidden=e.userName,app.userBank=e.userBank,app.userSpins=e.userSpins,app.userRate1=e.userRate1,app.userRate2=e.userRate2,app.userRate3=e.userRate3,app.userWinsCoin1=e.userWinsCoin1,app.userWinsCoin2=e.userWinsCoin2,app.userWinsCoin3=e.userWinsCoin3})},preGame(){if("signin"===app.modalSubNameCurrent)if(app.userPassHidden===app.userPass){let e=["С возвращением!","Добро пожаловать!","Ура! Вы вернулись!"];app.modalMessages=e[getRandom(0,e.length)],app.onGame(),$.fancybox.close()}else{let e=["Пароль не верный!","В пароле ошибка! Вы точно владелец этого аккаунта?","Пароль не верный! Вспоминайте... "];app.modalMessages=e[getRandom(0,e.length)]}else if("signup"===app.modalSubNameCurrent)if(app.userFound)if(0===app.userPass.length){let e=["Пожалуйста введите пароль...","Необходимо все же указать пароль!","Без пароля дальше никак :("];app.modalMessages=e[getRandom(0,e.length)]}else app.userPass.length>0&&app.userPass.length<3?app.modalMessages="Вы считаете это паролем? Введите минимум 3 символа!":app.userHint<=0?app.modalMessages="Объязательно укажите подсказу, если забудете пароль, востановить его не получиться!":app.userHint===app.userPass?app.modalMessages="Подсказка не может совпадать с паролем...":(app.modalMessages="Ура! Добро пожаловать!",app.addUser(app.userName,app.userPass,app.userHint),app.onGame(),$.fancybox.close(),setTimeout(()=>{app.openModal("modalRules")},2750));else app.spotUser()},onGame(){app.gamblingSectionShow=!0,setTimeout(()=>{app.$refs.main.classList.add(mainActive)},800),setTimeout(()=>{app.$refs.slots.classList.add(slotsActive),document.querySelectorAll(".common-section__decor").forEach(e=>{e.classList.add("common-section__decor_no-active")}),document.querySelectorAll(".gambling-section__decor").forEach(e=>{e.classList.add("gambling-section__decor_active")})},1e3),setTimeout(()=>{document.querySelectorAll(tableRow).forEach(e=>{e.classList.add("slots-top__table-row_no-active")})},3e3)},offGame(){this.$refs.slots.classList.remove(slotsActive),setTimeout(()=>{app.$refs.main.classList.remove(mainActive),document.querySelectorAll(".common-section__decor").forEach(e=>{e.classList.remove("common-section__decor_no-active")}),document.querySelectorAll(".gambling-section__decor").forEach(e=>{e.classList.remove("gambling-section__decor_active")})},150),setTimeout(()=>{app.gamblingSectionShow=!1,app.credits=0},2e3),app.update()},onSpin(){if(app.userRate>0)app.userBank-=app.userRate,app.userRate-=0,app.credits+=app.userRate,$.fancybox.close();else{let e=['Пока сумма ставки "0", начать игру не возможно!',"Необходимо указать сумму ставки больше текущей...",'Укажите сумму ставки выше "0"...'];app.modalMessages=e[getRandom(0,e.length)]}},spin(){app.spinAvialable=!1,app.coinLinesTemp={},app.coinLines={},app.drumsRing.forEach((elem,i)=>{let drumSlots=window[`drumSlots${i+1}`],drumRingDeg=window[`drumRingDeg${i+1}`],preSlot=window[`preSlot${i+1}`],curSlot=window[`curSlot${i+1}`],posSlot=window[`posSlot${i+1}`],deg=drumRingDeg;if(app.spinPred){let arrDs=drumSlots.slice(drumSlots.indexOf(curSlot)-1);arrDs.push.apply(arrDs,drumSlots);let comb=null;comb=app.combSeven?_.findIndex(arrDs,{name:eval("app.combs.comb7[0].slot1")}):_.findIndex(arrDs,{name:eval(`app.combs.comb${getRandom(1,4)}[0].slot1`)}),drumRingDeg-=45*(comb-1)+360*getRandom(1,10),window[`drumRingDeg${i+1}`]=drumRingDeg,curSlot=arrDs[comb],preSlot=arrDs[comb+1],arrDs[comb-1]&&(posSlot=arrDs[comb-1]),window[`preSlot${i+1}`]=preSlot,window[`curSlot${i+1}`]=curSlot,window[`posSlot${i+1}`]=posSlot}else{drumRingDeg-=app.degrees[getRandom(0,app.degrees.length)]*getRandom(1,50),window[`drumRingDeg${i+1}`]=drumRingDeg;let e=drumRingDeg-deg,a=Math.abs(e/45),s=drumSlots.slice(drumSlots.indexOf(curSlot));for(let p=0;p<=a;p++)s.push.apply(s,drumSlots),curSlot=s[p],e<0&&(preSlot=s[p+1],posSlot=s[p-1]);window[`preSlot${i+1}`]=preSlot,window[`curSlot${i+1}`]=curSlot,window[`posSlot${i+1}`]=posSlot}if(app.fill(i,preSlot,curSlot,posSlot),i===app.drumsRing.length-1){let e=[];if(app.check(e),e=getUnique(e,"coin"),app.spinRepeat)return app.spin(),app.spin;app.rotate(),app.win(e),app.userSpins++,1===app.coinsPlayed&&app.userRate1++,2===app.coinsPlayed&&app.userRate2++,3===app.coinsPlayed&&app.userRate3++}})},fill(e,a,s,p){0===e?(app.coinLinesTemp.coin1={},app.coinLinesTemp.coin2={},app.coinLinesTemp.coin3={},app.coinLinesTemp.coin1.slot1=s.name,app.coinLinesTemp.coin2.slot1=a.name,app.coinLinesTemp.coin3.slot1=p.name):1===e?(app.coinLinesTemp.coin1.slot2=s.name,app.coinLinesTemp.coin2.slot2=s.name,app.coinLinesTemp.coin3.slot2=s.name):2===e&&(app.coinLinesTemp.coin1.slot3=s.name,app.coinLinesTemp.coin2.slot3=p.name,app.coinLinesTemp.coin3.slot3=a.name),1===app.coinsPlayed?app.coinLines.coin1=app.coinLinesTemp.coin1:2===app.coinsPlayed?(app.coinLines.coin1=app.coinLinesTemp.coin1,app.coinLines.coin2=app.coinLinesTemp.coin2):3===app.coinsPlayed&&(app.coinLines.coin1=app.coinLinesTemp.coin1,app.coinLines.coin2=app.coinLinesTemp.coin2,app.coinLines.coin3=app.coinLinesTemp.coin3)},check(e){let a="",s=0,p=Object.keys(app.combs).length;for(key in app.spinRepeat=!1,app.spinPred=!1,app.combs){s++;let n=!1;if(a=_.findKey(app.coinLines,app.combs[key][0]),app.userRatio>.75)a&&key!=key?e.push({coin:a,comb:key}):a&&key==key&&(app.spinRepeat=!0,app.spinPred=!1);else if(app.userRatio>=.4&&app.userRatio<=.75)a&&"comb7"!==key?e.push({coin:a,comb:key}):a&&"comb7"===key&&(app.spinRepeat=!0,app.spinPred=!1);else if(app.userRatio<.4){if(a&&(n=!0),!0===n){e.push({coin:a,comb:key});continue}if(!1===n){if(s!==p)continue;s===p&&0===e.length&&(app.spinRepeat=!0,app.spinPred=!0)}}}},rotate(){app.drumsRing.forEach((elem,i)=>{eval(`this.$refs.drumRing${i+1}`).style.transform=`rotateX(${window[`drumRingDeg${i+1}`]}deg)`})},win(coins){setTimeout(()=>{coins.forEach(elem=>{if(eval(`app.$refs.${elem.coin}`).classList.add(coinLineWin),eval(`app.$refs.${elem.comb}`).classList.add(tableRowWin),app.winnerPaid+=eval(`app.combs.${elem.comb}[1]`),"coin1"===elem.coin&&app.userWinsCoin1++,"coin2"===elem.coin&&app.userWinsCoin2++,"coin3"===elem.coin&&app.userWinsCoin3++,"comb7"===elem.comb){var end=Date.now()+15e3,colors=["#FFA500","#008000","#FF0000"];!function e(){confetti({particleCount:3,angle:60,spread:55,origin:{x:0},colors:colors}),confetti({particleCount:3,angle:120,spread:55,origin:{x:1},colors:colors}),Date.now()<end&&requestAnimationFrame(e)}(),app.combSeven=!1}})},app.spinTime),setTimeout(()=>{app.resetElem(coinLine,coinLineWin),app.resetElem(tableRow,tableRowWin)},2*app.spinTime),app.reset()},reset(){setTimeout(()=>{app.userLoss+=app.coinsPlayed,app.credits=app.creditsHidden,app.credits+=app.winnerPaid,app.coinsPlayed=0,app.spinAvialable=!0,document.querySelectorAll(coinLine).forEach(e=>{e.classList.remove(coinLineOn)})},app.spinTime)},resetElem(e,a){document.querySelectorAll(e).forEach(e=>{e.classList.remove(a)})},click(e){"btnCashOut"===e&&app.spinAvialable&&(app.creditsHidden=app.coinsPlayed>0?app.creditsHidden+app.coinsPlayed:app.creditsHidden,app.credits=app.creditsHidden,app.userBank+=app.credits,app.update(),app.creditsHidden=0,app.credits=0,app.coinsPlayed=0,app.winnerPaid=0,app.spinAvialable=!app.spinAvialable,app.resetElem(coinLine,coinLineOn),app.resetElem(coinLine,coinLineWin),app.resetElem(tableRow,tableRowWin),app.userWin=0,app.userLoss=0,app.userRatio=1),"btnSpin"===e&&app.coinsPlayed>0&&app.spinAvialable&&(app.spin(),app.winnerPaid=0),"btnPlayMax"===e&&app.creditsHidden>0&&app.spinAvialable&&(app.creditsHidden<3&&3!==app.coinsPlayed?(app.coinsPlayed+=app.creditsHidden,app.creditsHidden-=app.creditsHidden):app.creditsHidden>=3&&(app.creditsHidden+=app.coinsPlayed,app.creditsHidden-=3,app.coinsPlayed=3),app.resetElem(coinLine,coinLineWin),app.resetElem(tableRow,tableRowWin),app.spin(),app.winnerPaid=0),"btnBetOne"===e&&(app.creditsHidden>0&&app.coinsPlayed<3&&app.spinAvialable&&(app.creditsHidden--,app.coinsPlayed++),app.spinAvialable&&(app.btnBetOne=3!==app.coinsPlayed&&0!==app.creditsHidden))},update(){app.topUsers=[],db.get(app.userNameHidden).then(e=>(e.userBank=app.userBank,e.userSpins=app.userSpins,e.userRate1=app.userRate1,e.userRate2=app.userRate2,e.userRate3=app.userRate3,e.userWinsCoin1=app.userWinsCoin1,e.userWinsCoin2=app.userWinsCoin2,e.userWinsCoin3=app.userWinsCoin3,db.put(e))),db.allDocs({include_docs:!0,attachments:!0}).then(e=>{!function(e){let a=[],s={};e.forEach(e=>{s={userName:e.doc.userName,userBank:e.doc.userBank},a.push(s)});let p=[];p=a.sort((e,a)=>{let s=e.userBank,p=a.userBank;return s>p?-1:s<p?1:0}).slice(0,5),app.topUsers=p}(e.rows)})}},watch:{userName(){app.spotUser()},userRate(e,a){let s=0;e>=0?e>a?(s=e-a,app.userBank-=s,app.userBank<0&&(app.userRate=0)):e<a&&e>=0&&(s=a-e,app.userBank+=s):app.userRate=0},spinAvialable(e){e?(app.btnCashOut=!0,app.btnPlayMax=!0,app.btnSpin=!1,app.btnBetOne=!0):(app.btnCashOut=!1,app.btnPlayMax=!1,app.btnSpin=!1,app.btnBetOne=!1)},userLoss(e){app.userRatio=e>0?app.userWin/app.userLoss:1},winnerPaid(e){app.userWin+=e},coinsPlayed(val){val>0&&app.spinAvialable&&(app.btnSpin=!0),val>0&&document.querySelectorAll(coinLine).forEach(e=>{e.classList.remove(coinLineWin)});for(let i=0;i<val;i++)eval(`app.$refs.coin${i+1}`).classList.add(coinLineOn)},credits(e){app.creditsHidden=e,0!==e?(app.spinAvialable=!0,document.querySelectorAll(tableRow).forEach(e=>{e.classList.remove("slots-top__table-row_no-active")})):(app.spinAvialable=!1,app.userWin=0,app.userLoss=0,document.querySelectorAll(tableRow).forEach(e=>{e.classList.add("slots-top__table-row_no-active")}))}},created(){this.drumsRing.forEach((e,a)=>{window[`drumSlots${a+1}`]=[],window[`curSlot${a+1}`]={},window[`preSlot${a+1}`]={},window[`posSlot${a+1}`]={},window[`drumRingDeg${a+1}`]=0,e.setAttribute("ref",`drumRing${a+1}`);let s=e.querySelectorAll(drumSlot),p=[];s.forEach(e=>{let a={num:e.getAttribute("data-num"),name:e.getAttribute("data-name")};p.push(a)}),window[`drumSlots${a+1}`]=p,window[`preSlot${a+1}`]=p[0],window[`curSlot${a+1}`]=p[p.length-1],window[`posSlot${a+1}`]=p[p.length-2]}),document.querySelectorAll(tableRow).forEach((e,a,s)=>{e.setAttribute("ref",`comb${s.length-a}`)}),db.allDocs({include_docs:!0,attachments:!0}).then(e=>{!function(e){let a=[],s={};e.forEach(e=>{s={userName:e.doc.userName,userBank:e.doc.userBank},a.push(s)});let p=[];p=a.sort((e,a)=>{let s=e.userBank,p=a.userBank;return s>p?-1:s<p?1:0}).slice(0,5),app.topUsers=p}(e.rows)})}});function getUnique(e,a){return e.map(e=>e[a]).map((e,a,s)=>s.indexOf(e)===a&&a).filter(a=>e[a]).map(a=>e[a])}function getRandom(e,a){return Math.floor(Math.random()*(a-e))+e}function r(e,a){return Math.random()*(a-e)+e}